!function(e){function r(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,r),o.l=!0,o.exports}var t={};r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:s})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},r.p="",r(r.s=4)}([function(e,r){e.exports=require("debug")},function(e,r){e.exports=require("express")},function(e,r){e.exports=require("mongoose")},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s=t(8);r.mongoURL=s.mongoURL;var o=t(9);r.ip=o.ip,r.port=o.port;var n=t(10);r.secret=n.secret},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s=t(1),o=t(5),n=t(6),i=t(7),a=t(2),u=t(0),l=t(3),c=t(11),p=u("paraboloid:server");p(">>> express");var d=s();p(">>> bodyParser"),d.use(n.json()),d.use(n.urlencoded({extended:!1})),p(">>> session"),d.use(o({secret:l.secret,cookie:{maxAge:6e4},resave:!1,saveUninitialized:!1})),p(">>> mongoose"),a.Promise=global.Promise,a.connect(l.mongoURL),p(">>> extra logging"),"development"===d.get("env")&&(d.use(i("dev")),a.set("debug",!0)),p(">>> api routes"),d.use(c.api),p(">>> dummy route"),d.use(function(e,r,t){r.status(404),t(new Error("Not Found"))}),p(">>> error handler"),d.use(function(e,r,t,s){p("Error %o: %o",t.statusCode,e.message),t.status(t.statusCode||500).json({errors:{message:e.message}})}),p(">>> listener");var g=d.listen(l.port,l.ip,function(){console.log("Listening on "+g.address().address+":"+g.address().port)})},function(e,r){e.exports=require("express-session")},function(e,r){e.exports=require("body-parser")},function(e,r){e.exports=require("morgan")},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s=t(0),o=s("paraboloid:server:mongo"),n=process.env.OPENSHIFT_MONGODB_DB_URL||process.env.MONGO_URL||"mongodb://localhost/paraboloid";if(r.mongoURL=n,o("original mongoURL %o",n),void 0===n&&process.env.DATABASE_SERVICE_NAME){var i=process.env.DATABASE_SERVICE_NAME;i&&i.toUpperCase();var a=process.env[i+"_SERVICE_HOST"],u=process.env[i+"_SERVICE_PORT"],l=process.env[i+"_DATABASE"],c=process.env[i+"_USER"],p=process.env[i+"_PASSWORD"];a&&u&&l&&(r.mongoURL=n="mongodb://",c&&p&&(r.mongoURL=n+=c+":"+p+"@"),r.mongoURL=n+=a+":"+u+"/"+l)}o("new mongoURL %o",n)},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s=t(0),o=s("paraboloid:server:address");r.ip=process.env.IP||process.env.OPENSHIFT_NODEJS_IP||"0.0.0.0",o("ip %o",r.ip),r.port=parseInt(process.env.PORT||process.env.OPENSHIFT_NODEJS_PORT||"8080"),o("port %o",r.port)},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s=t(0),o=s("paraboloid:server:session");r.secret=process.env.SECRET||"secret",o("Secret %o",r.secret)},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s=t(12);r.api=s.api,s.api.use("/api",s.api)},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s=t(1),o=t(0),n=t(13),i=t(21),a=t(22),u=o("paraboloid:Server:API"),l=s.Router();r.api=l,l.use("/users",n.users),l.use("/articles",i.articles),l.use("/tags",a.tags),l.use(function(e,r,t,s){if("ValidationError"===e.name)return u("%o: %o",e.name,e.message),t.status(422).json({errors:Object.keys(e.errors).reduce(function(r,t){return r[t]=e.errors[t].message,r},{})});s(e)})},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s=t(2),o=t(1),n=t(0),i=t(14),a=t(16),u=n("paraboloid:Server:API:Users"),l=o.Router();r.users=l;s.model("User");l.post("/",function(e,r,t){u(">>> Post /api/users/ with %o",e.body);try{var s=new a.UserModel;s.username=e.body.username,s.email=e.body.email,s.setPassword(e.body.password),s.save().then(function(){return u("User successfully saved"),r.status(201).json({user:s.toAuthJSON()})}).catch(t)}catch(e){r.status(422),t(e)}}),l.post("/login",function(e,r){r.status(200),r.json({path:e.originalUrl})}),l.put("/:user",i.auth.required,function(e,r){r.status(200),r.json({path:e.originalUrl,user:e.params.user})}),l.get("/:user",i.auth.required,function(e,r,t){r.status(200),r.json({path:e.originalUrl,user:e.params.user})})},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s=t(15),o=t(0),n=t(3),i=function(){function e(){this.log=o("paraboloid:Server:Authorization")}return e.prototype.getTokenFromHeader=function(e){this.log("Authorization header: %o",e.headers.authorization);var r=e.headers.authorization[0];if("Token"===r.split(" ")[0]||"Bearer"===r.split(" ")[0]){var t=r.split(" ")[1];return this.log("Token %o",t),t}return null},Object.defineProperty(e.prototype,"required",{get:function(){return this.log("Authorization required"),s({secret:n.secret,userProperty:"payload",getToken:this.getTokenFromHeader})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"optional",{get:function(){return this.log("Authorization optional"),s({secret:n.secret,userProperty:"payload",credentialsRequired:!1,getToken:this.getTokenFromHeader})},enumerable:!0,configurable:!0}),e}(),a=new i;r.auth=a},function(e,r){e.exports=require("express-jwt")},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s=t(17);r.UserModel=s.UserModel},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s=t(18),o=t(19),n=t(20),i=t(0),a=t(3),u=t(2),l=i("paraboloid:Server:Models:User"),c=new u.Schema({username:{type:String,lowercase:!0,unique:!0,required:[!0,"can't be blank"],match:[/^[a-zA-Z0-9]+$/,"is invalid"],index:!0},email:{type:String,lowercase:!0,unique:!0,required:[!0,"can't be blank"],match:[/\S+@\S+\.\S+/,"is invalid"],index:!0},bio:String,image:String,hash:String,salt:String},{timestamps:!0});c.plugin(s,{message:"is already taken."}),c.methods.validPassword=function(e){var r=o.pbkdf2Sync(e,this.salt,1e4,512,"sha512").toString("hex");return l("Hash %o is compared to user hash %o",r,this.hash),this.hash===r},c.methods.setPassword=function(e){this.salt=o.randomBytes(16).toString("hex"),this.hash=o.pbkdf2Sync(e,this.salt,1e4,512,"sha512").toString("hex"),l("Hash %o and salt %o generated for password %o",this.hash,this.salt,e)},c.methods.generateJWT=function(){var e=new Date,r=new Date(e);return r.setDate(e.getDate()+60),l("JWT generated for %o until %o",this.username,r),n.sign({id:this._id,username:this.username,exp:r.getTime()/1e3},a.secret)},c.methods.toAuthJSON=function(){var e={username:this.username,email:this.email,token:this.generateJWT(),bio:this.bio,image:this.image};return l("JWT token: %o",e),e},r.UserModel=u.model("User",c)},function(e,r){e.exports=require("mongoose-unique-validator")},function(e,r){e.exports=require("crypto")},function(e,r){e.exports=require("jsonwebtoken")},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s=t(1),o=s.Router();r.articles=o,o.get("/",function(e,r){r.status(200),r.json({path:e.originalUrl,tag:e.query.tag,author:e.query.author,limit:e.query.limit,offset:e.query.offset})}),o.post("/",function(e,r){r.status(201),r.json({path:e.originalUrl})}),o.get("/:slug",function(e,r){r.status(200),r.json({path:e.originalUrl,slug:e.params.slug})}),o.put("/:slug",function(e,r){r.status(200),r.json({path:e.originalUrl,slug:e.params.slug})}),o.delete("/:slug",function(e,r){r.status(200),r.json({path:e.originalUrl,slug:e.params.slug})}),o.post("/:slug/comments",function(e,r){r.status(201),r.json({path:e.originalUrl,slug:e.params.slug})}),o.get("/:slug/comments",function(e,r){r.status(200),r.json({path:e.originalUrl,slug:e.params.slug})}),o.delete("/:slug/comments/:id",function(e,r){r.status(200),r.json({path:e.originalUrl,slug:e.params.slug,id:e.params.id})})},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s=t(1),o=s.Router();r.tags=o,o.get("/",function(e,r){r.json({path:e.originalUrl})})}]);